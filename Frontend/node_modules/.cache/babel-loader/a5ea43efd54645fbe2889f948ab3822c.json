{"remainingRequest":"/home/hab07/Desktop/ProyectoBackFront/Frontend/node_modules/babel-loader/lib/index.js!/home/hab07/Desktop/ProyectoBackFront/Backend/helpers.js","dependencies":[{"path":"/home/hab07/Desktop/ProyectoBackFront/Backend/helpers.js","mtime":1592301376979},{"path":"/home/hab07/Desktop/ProyectoBackFront/Frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/hab07/Desktop/ProyectoBackFront/Frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIik7CgpyZXF1aXJlKCJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiKTsKCnZhciBfYXN5bmNUb0dlbmVyYXRvciA9IHJlcXVpcmUoIi9ob21lL2hhYjA3L0Rlc2t0b3AvUHJveWVjdG9CYWNrRnJvbnQvRnJvbnRlbmQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXN5bmNUb0dlbmVyYXRvciIpOwoKcmVxdWlyZSgnZG90ZW52JykuY29uZmlnKCk7Cgp2YXIgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTsKCnZhciBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTsKCnZhciBzZ01haWwgPSByZXF1aXJlKCdAc2VuZGdyaWQvbWFpbCcpOwoKdmFyIHNoYXJwID0gcmVxdWlyZSgnc2hhcnAnKTsKCnZhciBfcmVxdWlyZSA9IHJlcXVpcmUoJ2RhdGUtZm5zJyksCiAgICBmb3JtYXQgPSBfcmVxdWlyZS5mb3JtYXQ7Cgp2YXIgZnMgPSByZXF1aXJlKCdmcy1leHRyYScpOwoKdmFyIHV1aWQgPSByZXF1aXJlKCd1dWlkJyk7Cgp2YXIgaW1hZ2VVcGxvYWRQYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgcHJvY2Vzcy5lbnYuVVBMT0FEU19ESVIpOwpjb25zb2xlLmxvZyhwYXRoKTsKCmZ1bmN0aW9uIGZvcm1hdERhdGVUb0RCKGRhdGUpIHsKICByZXR1cm4gZm9ybWF0KGRhdGUsICd5eXl5LU1NLWRkIEhIOm1tOnNzJyk7Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlRXJyb3IobWVzc2FnZSwgY29kZSkgewogIHZhciBlcnJvciA9IG5ldyBFcnJvcihtZXNzYWdlKTsKICBpZiAoY29kZSkgZXJyb3IuaHR0cENvZGUgPSBjb2RlOwogIHJldHVybiBlcnJvcjsKfQoKZnVuY3Rpb24gcmFuZG9tU3RyaW5nKCkgewogIHZhciBzaXplID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAyMDsKICByZXR1cm4gY3J5cHRvLnJhbmRvbUJ5dGVzKHNpemUpLnRvU3RyaW5nKCdoZXgnKS5zbGljZSgwLCBzaXplKTsKfQoKZnVuY3Rpb24gc2VuZEVtYWlsKF94KSB7CiAgcmV0dXJuIF9zZW5kRW1haWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gX3NlbmRFbWFpbCgpIHsKICBfc2VuZEVtYWlsID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKF9yZWYpIHsKICAgIHZhciBlbWFpbCwgdGl0bGUsIGNvbnRlbnQsIG1zZzsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgZW1haWwgPSBfcmVmLmVtYWlsLCB0aXRsZSA9IF9yZWYudGl0bGUsIGNvbnRlbnQgPSBfcmVmLmNvbnRlbnQ7CiAgICAgICAgICAgIHNnTWFpbC5zZXRBcGlLZXkocHJvY2Vzcy5lbnYuU0VOREdSSURfS0VZKTsKICAgICAgICAgICAgbXNnID0gewogICAgICAgICAgICAgIHRvOiBlbWFpbCwKICAgICAgICAgICAgICBmcm9tOiAnaXNhc2FuY2hlenRvcnJvbkBnbWFpbC5jb20nLAogICAgICAgICAgICAgIHN1YmplY3Q6IHRpdGxlLAogICAgICAgICAgICAgIHRleHQ6IGNvbnRlbnQsCiAgICAgICAgICAgICAgaHRtbDogIjxkaXY+XG4gICAgICA8aDE+UG9yIGZhdm9yLCB2YWxpZGEgdHUgZW1haWwuPC9oMT5cbiAgICAgIDxwPiIuY29uY2F0KGNvbnRlbnQsICI8L3A+ICBcbiAgICA8L2Rpdj4iKQogICAgICAgICAgICB9OwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTsKICAgICAgICAgICAgcmV0dXJuIHNnTWFpbC5zZW5kKG1zZyk7CgogICAgICAgICAgY2FzZSA1OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUpOwogIH0pKTsKICByZXR1cm4gX3NlbmRFbWFpbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBwcm9jZXNzQW5kU2F2ZVBob3RvKF94MikgewogIHJldHVybiBfcHJvY2Vzc0FuZFNhdmVQaG90by5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBfcHJvY2Vzc0FuZFNhdmVQaG90bygpIHsKICBfcHJvY2Vzc0FuZFNhdmVQaG90byA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIodXBsb2FkZWRJbWFnZSkgewogICAgdmFyIHNhdmVkRmlsZU5hbWUsIGZpbmFsSW1hZ2UsIGltYWdlSW5mbzsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHNhdmVkRmlsZU5hbWUgPSAiIi5jb25jYXQodXVpZC52MSgpLCAiLmpwZyIpOwogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgIHJldHVybiBmcy5lbnN1cmVEaXIoaW1hZ2VVcGxvYWRQYXRoKTsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIGZpbmFsSW1hZ2UgPSBzaGFycCh1cGxvYWRlZEltYWdlLmRhdGEpOwogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDY7CiAgICAgICAgICAgIHJldHVybiBmaW5hbEltYWdlLm1ldGFkYXRhKCk7CgogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBpbWFnZUluZm8gPSBfY29udGV4dDIuc2VudDsKCiAgICAgICAgICAgIGlmIChpbWFnZUluZm8ud2lkdGggPiA0NTApIHsKICAgICAgICAgICAgICBmaW5hbEltYWdlLnJlc2l6ZSg0NTApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEwOwogICAgICAgICAgICByZXR1cm4gZmluYWxJbWFnZS50b0ZpbGUocGF0aC5qb2luKGltYWdlVXBsb2FkUGF0aCwgc2F2ZWRGaWxlTmFtZSkpOwoKICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBzYXZlZEZpbGVOYW1lKTsKCiAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlMik7CiAgfSkpOwogIHJldHVybiBfcHJvY2Vzc0FuZFNhdmVQaG90by5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBkZWxldGVQaG90byhfeDMpIHsKICByZXR1cm4gX2RlbGV0ZVBob3RvLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIF9kZWxldGVQaG90bygpIHsKICBfZGVsZXRlUGhvdG8gPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKGltYWdlUGF0aCkgewogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyOwogICAgICAgICAgICByZXR1cm4gZnMudW5saW5rKHBhdGguam9pbihpbWFnZVVwbG9hZFBhdGgsIGltYWdlUGF0aCkpOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTMpOwogIH0pKTsKICByZXR1cm4gX2RlbGV0ZVBob3RvLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCm1vZHVsZS5leHBvcnRzID0gewogIGZvcm1hdERhdGVUb0RCOiBmb3JtYXREYXRlVG9EQiwKICBzZW5kRW1haWw6IHNlbmRFbWFpbCwKICBnZW5lcmF0ZUVycm9yOiBnZW5lcmF0ZUVycm9yLAogIHJhbmRvbVN0cmluZzogcmFuZG9tU3RyaW5nLAogIHByb2Nlc3NBbmRTYXZlUGhvdG86IHByb2Nlc3NBbmRTYXZlUGhvdG8sCiAgZGVsZXRlUGhvdG86IGRlbGV0ZVBob3RvCn07"},{"version":3,"sources":["/home/hab07/Desktop/ProyectoBackFront/Backend/helpers.js"],"names":["require","config","path","crypto","sgMail","sharp","format","fs","uuid","imageUploadPath","join","__dirname","process","env","UPLOADS_DIR","console","log","formatDateToDB","date","generateError","message","code","error","Error","httpCode","randomString","size","randomBytes","toString","slice","sendEmail","email","title","content","setApiKey","SENDGRID_KEY","msg","to","from","subject","text","html","send","processAndSavePhoto","uploadedImage","savedFileName","v1","ensureDir","finalImage","data","metadata","imageInfo","width","resize","toFile","deletePhoto","imagePath","unlink","module","exports"],"mappings":"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","sourcesContent":["require('dotenv').config();\n\nconst path = require('path');\nconst crypto = require('crypto');\nconst sgMail = require('@sendgrid/mail');\nconst sharp = require('sharp');\n\nconst { format } = require('date-fns');\n\nconst fs = require('fs-extra');\nconst uuid = require('uuid');\n\nconst imageUploadPath = path.join(__dirname, process.env.UPLOADS_DIR);\n\nconsole.log(path);\n\nfunction formatDateToDB(date) {\n  return format(date, 'yyyy-MM-dd HH:mm:ss');\n}\n\nfunction generateError(message, code) {\n  const error = new Error(message);\n  if (code) error.httpCode = code;\n  return error;\n}\n\nfunction randomString(size = 20) {\n  return crypto.randomBytes(size).toString('hex').slice(0, size);\n}\n\nasync function sendEmail({ email, title, content }) {\n  sgMail.setApiKey(process.env.SENDGRID_KEY);\n\n  const msg = {\n    to: email,\n    from: 'isasancheztorron@gmail.com',\n    subject: title,\n    text: content,\n    html: `<div>\n      <h1>Por favor, valida tu email.</h1>\n      <p>${content}</p>  \n    </div>`\n  };\n\n  await sgMail.send(msg);\n}\n\nasync function processAndSavePhoto(uploadedImage) {\n  const savedFileName = `${uuid.v1()}.jpg`;\n\n  await fs.ensureDir(imageUploadPath);\n  const finalImage = sharp(uploadedImage.data);\n  const imageInfo = await finalImage.metadata();\n\n  if (imageInfo.width > 450) {\n    finalImage.resize(450);\n  }\n\n  await finalImage.toFile(path.join(imageUploadPath, savedFileName));\n\n  return savedFileName;\n}\n\nasync function deletePhoto(imagePath) {\n  await fs.unlink(path.join(imageUploadPath, imagePath));\n}\n\nmodule.exports = {\n  formatDateToDB,\n  sendEmail,\n  generateError,\n  randomString,\n  processAndSavePhoto,\n  deletePhoto\n};\n"]}]}